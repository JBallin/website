"use strict";(self.webpackChunkcnoe=self.webpackChunkcnoe||[]).push([[8411],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>k});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),c=p(a),m=i,k=c["".concat(s,".").concat(m)]||c[m]||d[m]||o;return a?n.createElement(k,l(l({ref:t},u),{},{components:a})):n.createElement(k,l({ref:t},u))}));function k(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,l=new Array(o);l[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[c]="string"==typeof e?e:i,l[1]=r;for(var p=2;p<o;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},6751:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var n=a(7462),i=(a(7294),a(3905));const o={sidebar_position:1,description:"A multitudinal and communal plan",title:"Application IDP"},l=void 0,r={unversionedId:"reference-implementation/installations/app-idp",id:"reference-implementation/installations/app-idp",title:"Application IDP",description:"A multitudinal and communal plan",source:"@site/docs/reference-implementation/installations/app-idp.md",sourceDirName:"reference-implementation/installations",slug:"/reference-implementation/installations/app-idp",permalink:"/docs/reference-implementation/installations/app-idp",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/reference-implementation/installations/app-idp.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,description:"A multitudinal and communal plan",title:"Application IDP"},sidebar:"tutorialSidebar",previous:{title:"Installation",permalink:"/docs/reference-implementation/installations/"},next:{title:"Data & Analytics IDP",permalink:"/docs/reference-implementation/installations/data-idp"}},s={},p=[{value:"Notes",id:"notes",level:2},{value:"Secret handling.",id:"secret-handling",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Create GitHub Apps for your GitHub Organization",id:"create-github-apps-for-your-github-organization",level:2},{value:"Create a GitHub token",id:"create-a-github-token",level:2},{value:"Install",id:"install",level:2},{value:"Monitoring installation progress",id:"monitoring-installation-progress",level:3},{value:"If you installed it without automatic DNS configuration.",id:"if-you-installed-it-without-automatic-dns-configuration",level:3},{value:"If you installed it without Cert Manager.",id:"if-you-installed-it-without-cert-manager",level:3},{value:"What was created?",id:"what-was-created",level:2},{value:"Things created outside the cluster",id:"things-created-outside-the-cluster",level:3},{value:"Uninstall",id:"uninstall",level:2},{value:"Resources deleted",id:"resources-deleted",level:3},{value:"What can you do in Backstage?",id:"what-can-you-do-in-backstage",level:2},{value:"Possible issues",id:"possible-issues",level:2},{value:"Cert-manager",id:"cert-manager",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Creation Order notes",id:"creation-order-notes",level:2},{value:"Things created outside the cluster with Keycloak SSO enabled.",id:"things-created-outside-the-cluster-with-keycloak-sso-enabled",level:2},{value:"Keycloak SSO with DNS and TLS certificates",id:"keycloak-sso-with-dns-and-tls-certificates",level:3},{value:"Keycloak SSO with manual DNS and TLS Certificates",id:"keycloak-sso-with-manual-dns-and-tls-certificates",level:3},{value:"No SSO",id:"no-sso",level:3}],u={toc:p},c="wrapper";function d(e){let{components:t,...o}=e;return(0,i.kt)(c,(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"overview",src:a(4294).Z,width:"2454",height:"2294"})),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"NOTE:")),"  Applications deployed in this repository are not meant or configured for production.")),(0,i.kt)("h2",{id:"notes"},"Notes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"INSTALL SCRIPTS MUST BE RAN AGAINST AN EKS CLUSTER. We use IRSA to talk to AWS services."),(0,i.kt)("li",{parentName:"ul"},"Components are installed as ArgoCD Applications."),(0,i.kt)("li",{parentName:"ul"},"Files under the ",(0,i.kt)("inlineCode",{parentName:"li"},"/packages")," directory are meant to be suable without any modifications. This means certain configuration options like domain name must be passed outside of this directory. e.g. use ArgoCD's Helm parameters.")),(0,i.kt)("p",null,"We could probably deploy everything as a ArgoCD's app of apps with sync wave and what not. TODOooo"),(0,i.kt)("h2",{id:"secret-handling"},"Secret handling."),(0,i.kt)("p",null,"Currently handled outside of repository and set via bash script. Secrets such as GitHub token and TLS private keys are stored in the ",(0,i.kt)("inlineCode",{parentName:"p"},"/private")," directory."),(0,i.kt)("p",null,"May use sealed secrets with full GitOps approach in the future. TODO"),(0,i.kt)("h1",{id:"installation"},"Installation"),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Github ORGANIZATION"),(0,i.kt)("li",{parentName:"ul"},"An existing k8s cluster"),(0,i.kt)("li",{parentName:"ul"},"AWS CLI"),(0,i.kt)("li",{parentName:"ul"},"Kubectl CLI"),(0,i.kt)("li",{parentName:"ul"},"jq"),(0,i.kt)("li",{parentName:"ul"},"git"),(0,i.kt)("li",{parentName:"ul"},"curl"),(0,i.kt)("li",{parentName:"ul"},"kustomize"),(0,i.kt)("li",{parentName:"ul"},"node + npm (if you choose to create GitHub App via CLI)")),(0,i.kt)("h2",{id:"create-github-apps-for-your-github-organization"},"Create GitHub Apps for your GitHub Organization"),(0,i.kt)("p",null,"We strongly encourage you to create a ",(0,i.kt)("strong",{parentName:"p"},"dedicated GitHub organization"),". If you don't have an organization for this purpose, please follow ",(0,i.kt)("a",{parentName:"p",href:"https://docs.github.com/en/organizations/collaborating-with-groups-in-organizations/creating-a-new-organization-from-scratch"},"this link")," to create one."),(0,i.kt)("p",null,"There are two ways to create GitHub integration with Backstage. You can use the Backstage CLI, or create it manually. See ",(0,i.kt)("a",{parentName:"p",href:"https://backstage.io/docs/integrations/github/github-apps"},"this page")," for more information on creating one manually. Once the app is created, place it under the private directory with the name ",(0,i.kt)("inlineCode",{parentName:"p"},"github-integration.yaml"),"."),(0,i.kt)("p",null,"To create one with the CLI, follow the steps below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Clone the repository if you haven't already.\ngit clone git@github.com:cnoe-io/reference-implementation-aws.git\ncd reference-implementation-aws\n\nnpx '@backstage/cli' create-github-app ${GITHUB_ORG_NAME}\n# If prompted, select all for permissions.\n# In the browser window, allow access to all repositories then install the app.\n\n# move it to a \"private\" location. \nmkdir -p private\nGITHUB_APP_FILE=$(ls github-app-* | head -n1)\nmv ${GITHUB_APP_FILE} private/github-integration.yaml\n")),(0,i.kt)("p",null,"The file created above contains credentials. Handle it with care."),(0,i.kt)("p",null,"The rest of the installation process assumes the GitHub app credentials are available at ",(0,i.kt)("inlineCode",{parentName:"p"},"private/github-integration.yaml")),(0,i.kt)("p",null,"If you want to delete the GitHUb application, follow ",(0,i.kt)("a",{parentName:"p",href:"https://docs.github.com/en/apps/maintaining-github-apps/deleting-a-github-app"},"these steps"),"."),(0,i.kt)("h2",{id:"create-a-github-token"},"Create a GitHub token"),(0,i.kt)("p",null,"A GitHub token is needed by ArgoCD to get information about repositories under your Organization."),(0,i.kt)("p",null,"The following permissions are needed:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Repository access for all repositories"),(0,i.kt)("li",{parentName:"ul"},"Read-only access to: Administration, Contents, and Metadata.\nGet your GitHub personal access token from: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/settings/tokens?type=beta"},"https://github.com/settings/tokens?type=beta"))),(0,i.kt)("p",null,"Once you have your token, save it under the private directory with the name ",(0,i.kt)("inlineCode",{parentName:"p"},"github-token"),". For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Clone the repository if you haven't already.\ngit clone git@github.com:cnoe-io/reference-implementation-aws.git\ncd reference-implementation-aws\n\n# From the root of this repository.\n$ mkdir -p private\n$ vim private/github-token # paste your token\n# example output\n$ cat private/github-token\ngithub_pat_ABCDEDFEINDK....\n")),(0,i.kt)("h2",{id:"install"},"Install"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"READ THE SECTION ABOVE.")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Create GitHub apps and GitHub token as described above."),(0,i.kt)("li",{parentName:"ol"},"Create a new EKS cluster. You can use an existing cluster,but we cannot guarantee any existing resources will work with the script. You can create a new basic cluster with the included ",(0,i.kt)("a",{parentName:"li",href:"./eksctl.yaml"},(0,i.kt)("inlineCode",{parentName:"a"},"eksctl.yaml"))," file:\n",(0,i.kt)("inlineCode",{parentName:"li"},"eksctl create -f eksctl.yaml"),"\nYou can get eksctl from ",(0,i.kt)("a",{parentName:"li",href:"https://eksctl.io/"},"this link"),"."),(0,i.kt)("li",{parentName:"ol"},"If you don't have a public registered Route53 zone, ",(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-register.html"},"register a Route53 domain")," (be sure to use Route53 as the DNS service for the domain). We ",(0,i.kt)("strong",{parentName:"li"},"strongly encourage creating a dedicated subdomain")," for this. If you'd prefer managing DNS somewhere else, set ",(0,i.kt)("inlineCode",{parentName:"li"},"MANAGED_DNS=false")),(0,i.kt)("li",{parentName:"ol"},"Get the host zone id and put it in the config file. e.g.",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"aws route53 list-hosted-zones-by-name --dns-name <YOUR_DOMAIN_NAME> --query 'HostedZones[0].Id' --output text | cut -d'/' -f3\n# in the setups/config file, update the zone id.\nHOSTEDZONE_ID=ZO020111111\n"))),(0,i.kt)("li",{parentName:"ol"},"Update the ",(0,i.kt)("a",{parentName:"li",href:"setups/config"},(0,i.kt)("inlineCode",{parentName:"a"},"setups/config"))," file with your own values."),(0,i.kt)("li",{parentName:"ol"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"setups/install.sh")," and follow the prompts. See the section below about monitoring installation progress."),(0,i.kt)("li",{parentName:"ol"},"Once installation completes, navigate to ",(0,i.kt)("inlineCode",{parentName:"li"},"idp.<DOMAIN_NAME>")," and log in as ",(0,i.kt)("inlineCode",{parentName:"li"},"user1"),". Password is available as a secret. You may need to wait for DNS propagation to complete to be able to log in. May take ~10 minutes.",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl get secrets -n keycloak keycloak-user-config -o go-template=\'{{range $k,$v := .data}}{{printf "%s: " $k}}{{if not $v}}{{$v}}{{else}}{{$v | base64decode}}{{end}}{{"\\n"}}{{end}}\'\n')))),(0,i.kt)("h3",{id:"monitoring-installation-progress"},"Monitoring installation progress"),(0,i.kt)("p",null,"Components are installed as ArgoCD Applications. You can monitor installation progress by going to ArgoCD UI."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'# Get the admin password \nkubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d\n\nkubectl port-forward svc/argocd-server -n argocd 8081:80\n')),(0,i.kt)("p",null,"Go to ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:8081"},(0,i.kt)("inlineCode",{parentName:"a"},"http://localhost:8081"))," and login with the username ",(0,i.kt)("inlineCode",{parentName:"p"},"admin")," and password obtained above. In the UI you can look at resources created, their logs, and events."),(0,i.kt)("h3",{id:"if-you-installed-it-without-automatic-dns-configuration"},"If you installed it without automatic DNS configuration."),(0,i.kt)("p",null,"If you set ",(0,i.kt)("inlineCode",{parentName:"p"},"MANAGED_DNS=false"),", you are responsible for updating DNS records, thus external-dns is not installed. You have to set the following DNS records:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"idp.<DOMAIN_NAME>")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"keycloak.<DOMAIN_NAME>")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"argo.<DOMAIN_NAME>")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"argocd.<DOMAIN_NAME>"))),(0,i.kt)("p",null,"Point these records to the value returned by the following command."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"k get svc -n ingress-nginx ingress-nginx-controller -o jsonpath='{.status.loadBalancer.ingress[0].hostname}'\n")),(0,i.kt)("h3",{id:"if-you-installed-it-without-cert-manager"},"If you installed it without Cert Manager."),(0,i.kt)("p",null,"If you set ",(0,i.kt)("inlineCode",{parentName:"p"},"MANAGED_CERT=false"),", you are responsible for managing TLS certs, thus cert-manager is not installed. You must ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/services-networking/ingress/#tls"},"create TLS secrets accordingly"),"."),(0,i.kt)("p",null,"Run the following command to find where to create secrets."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'output=$(kubectl get ingress --all-namespaces -o json | jq -r \'.items[] | "\\(.metadata.namespace) \\(.spec.rules[].host) \\(.spec.tls[].secretName)"\')\necho -e "Namespace \\t Hostname \\t TLS Secret Name"\necho -e "$output"\n')),(0,i.kt)("p",null,"Secret format should be something like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Secret\nmetadata:\n  name: idp.<DOMAIN>\n  namespace: backstage\ndata:\n  tls.crt: <base64 encoded cert>\n  tls.key: <base64 encoded key>\ntype: kubernetes.io/tls\n\n")),(0,i.kt)("h2",{id:"what-was-created"},"What was created?"),(0,i.kt)("p",null,"The following components are installed if you chose the full installation option."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"argo-workflows"),(0,i.kt)("li",{parentName:"ul"},"argocd"),(0,i.kt)("li",{parentName:"ul"},"aws-load-balancer-controller"),(0,i.kt)("li",{parentName:"ul"},"backstage"),(0,i.kt)("li",{parentName:"ul"},"cert-manager"),(0,i.kt)("li",{parentName:"ul"},"crossplane"),(0,i.kt)("li",{parentName:"ul"},"external-dns"),(0,i.kt)("li",{parentName:"ul"},"ingress-nginx"),(0,i.kt)("li",{parentName:"ul"},"keycloak"),(0,i.kt)("li",{parentName:"ul"},"spark-operator")),(0,i.kt)("h3",{id:"things-created-outside-the-cluster"},"Things created outside the cluster"),(0,i.kt)("p",null,"If full installation is done, you should have these DNS entries available. They all point to the Network Load Balancer."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"idp.<DOMAIN_NAME>")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"argo.<DOMAIN_NAME>")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"keycloak.<DOMAIN_NAME>"))),(0,i.kt)("p",null,"You can confirm these by querying at a register."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"dig A `idp.<DOMAIN_NAME>` @1.1.1.1\n\nkubeclt get svc -n ingress-nginx\n")),(0,i.kt)("p",null,"HTTPS endpoints are also created with valid certificates."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'openssl s_client -showcerts -servername id.<DOMAIN_NAME> -connect id.<DOMAIN_NAME>:443 <<< "Q"\ncurl https://idp.id.<DOMAIN_NAME>\n')),(0,i.kt)("p",null,"When you open a browser window and go to ",(0,i.kt)("inlineCode",{parentName:"p"},"https://idp.<DOMAIN_NAME>"),", you should be prompted to log in.\nTwo users are created during the installation process: ",(0,i.kt)("inlineCode",{parentName:"p"},"user1")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"user2"),". Their passwords are available in the keycloak namespace."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'k get secrets -n keycloak keycloak-user-config -o go-template=\'{{range $k,$v := .data}}{{printf "%s: " $k}}{{if not $v}}{{$v}}{{else}}{{$v | base64decode}}{{end}}{{"\\n"}}{{end}}\'\n')),(0,i.kt)("h2",{id:"uninstall"},"Uninstall"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"setups/uninstall.sh")," and follow the prompts."),(0,i.kt)("li",{parentName:"ol"},"Remove GitHub app from your Organization by following ",(0,i.kt)("a",{parentName:"li",href:"https://docs.github.com/en/apps/maintaining-github-apps/deleting-a-github-app"},"these steps"),"."),(0,i.kt)("li",{parentName:"ol"},"Remove token from your GitHub Organization by following ",(0,i.kt)("a",{parentName:"li",href:"https://docs.github.com/en/organizations/managing-programmatic-access-to-your-organization/reviewing-and-revoking-personal-access-tokens-in-your-organization"},"these steps"),"."),(0,i.kt)("li",{parentName:"ol"},"Remove the created GitHub Organization.")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Uninstall details"),(0,i.kt)("h3",{id:"resources-deleted"},"Resources deleted"),(0,i.kt)("p",null,"Currently, resources created by applications are not deleted. For example, if you have Spark Jobs running, they are not deleted and may block deletion of the spark-operator app.")),(0,i.kt)("h2",{id:"what-can-you-do-in-backstage"},"What can you do in Backstage?"),(0,i.kt)("p",null,"TODOOOO"),(0,i.kt)("h2",{id:"possible-issues"},"Possible issues"),(0,i.kt)("h3",{id:"cert-manager"},"Cert-manager"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"By default, it uses http-01 challenge. If you'd prefer using dns-01, you can update the ingress files. TODO AUTOMATE THIS"),(0,i.kt)("li",{parentName:"ul"},"You may get events like ",(0,i.kt)("inlineCode",{parentName:"li"},'Get "http://<DOMAIN>/.well-known/acme-challenge/09yldI6tVRvtWVPyMfwCwsYdOCEGGVWhmb1PWzXwhXI": dial tcp: lookup <DOMAIN> on 10.100.0.10:53: no such host'),". This is due to DNS propagation delay. It may take ~10 minutes.")),(0,i.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"TROUBLESHOOTING.md"},"the troubleshooting doc")," for more information."),(0,i.kt)("h2",{id:"creation-order-notes"},"Creation Order notes"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Click to expand"),(0,i.kt)("h2",{id:"things-created-outside-the-cluster-with-keycloak-sso-enabled"},"Things created outside the cluster with Keycloak SSO enabled."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Route53 records. Route53 hosted zones are not created. You must also register it if you want to be able to access through public DNS. These are managed by the external DNS controller.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"AWS Network Load Balancer. This is just the entrance to the Kubernetes cluster. This points to the default installation of Ingress Nginx and is managed by AWS Load Balancer Controller.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"TLS Certificates issued by Let's Encrypt. These are managed by cert-manager based on values in Ingress. They use the production issuer which means we must be very careful with how many and often we request certificates from them. The uninstall scripts backup certificates to the ",(0,i.kt)("inlineCode",{parentName:"p"},"private")," directory to avoid re-issuing certificates."))),(0,i.kt)("p",null,"These resources are controlled by Kubernetes controllers and thus should be deleted using controllers."),(0,i.kt)("h3",{id:"keycloak-sso-with-dns-and-tls-certificates"},"Keycloak SSO with DNS and TLS certificates"),(0,i.kt)("p",null,"If using keycloak SSO with fully automated DNS and certificate management, it must be:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"aws-load-balancer-controller"),(0,i.kt)("li",{parentName:"ol"},"ingress-nginx"),(0,i.kt)("li",{parentName:"ol"},"cert-manager"),(0,i.kt)("li",{parentName:"ol"},"external-dns"),(0,i.kt)("li",{parentName:"ol"},"keycloak"),(0,i.kt)("li",{parentName:"ol"},"The rest of stuff")),(0,i.kt)("h3",{id:"keycloak-sso-with-manual-dns-and-tls-certificates"},"Keycloak SSO with manual DNS and TLS Certificates"),(0,i.kt)("p",null,"If using keycloak SSO but manage DNS records and certificates manually."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"aws-load-balancer-controller"),(0,i.kt)("li",{parentName:"ol"},"ingress-nginx"),(0,i.kt)("li",{parentName:"ol"},"The rest of stuff minus cert-manager and external-dns")),(0,i.kt)("p",null,"In this case, you can issue your own certs and provide them as TLS secrets as specified in the ",(0,i.kt)("inlineCode",{parentName:"p"},"spec.tls[0].secretName")," field of Ingress objects.\nYou can also let NLB or ALB terminate TLS instead using the LB controller. This is not covered currently, but possible."),(0,i.kt)("h3",{id:"no-sso"},"No SSO"),(0,i.kt)("p",null,"If no SSO, no particular installation order. Eventual consistency works.")))}d.isMDXComponent=!0},4294:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/application-idp-f2aacfd5d39e181a17aee519f7a540ca.png"}}]);